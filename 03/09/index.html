<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>负载均衡器的使用 | 交接文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/handover/hero.svg">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/handover/assets/css/0.styles.f8d78339.css" as="style"><link rel="preload" href="/handover/assets/js/app.0bd4e087.js" as="script"><link rel="preload" href="/handover/assets/js/2.40eece3a.js" as="script"><link rel="preload" href="/handover/assets/js/17.f8650417.js" as="script"><link rel="prefetch" href="/handover/assets/js/10.272653f1.js"><link rel="prefetch" href="/handover/assets/js/11.742c26f2.js"><link rel="prefetch" href="/handover/assets/js/12.18bc48d7.js"><link rel="prefetch" href="/handover/assets/js/13.c69daf34.js"><link rel="prefetch" href="/handover/assets/js/14.f032ed61.js"><link rel="prefetch" href="/handover/assets/js/15.62f784ac.js"><link rel="prefetch" href="/handover/assets/js/16.eb5b5be5.js"><link rel="prefetch" href="/handover/assets/js/18.dfedbf20.js"><link rel="prefetch" href="/handover/assets/js/19.f7e0f19b.js"><link rel="prefetch" href="/handover/assets/js/20.3ea0f030.js"><link rel="prefetch" href="/handover/assets/js/21.6b415d81.js"><link rel="prefetch" href="/handover/assets/js/22.fe44f683.js"><link rel="prefetch" href="/handover/assets/js/23.35da1f9e.js"><link rel="prefetch" href="/handover/assets/js/24.e4da81e8.js"><link rel="prefetch" href="/handover/assets/js/25.53623594.js"><link rel="prefetch" href="/handover/assets/js/26.27a315c6.js"><link rel="prefetch" href="/handover/assets/js/27.2c96ed45.js"><link rel="prefetch" href="/handover/assets/js/28.7e031f1e.js"><link rel="prefetch" href="/handover/assets/js/29.e8295554.js"><link rel="prefetch" href="/handover/assets/js/3.dd08ab77.js"><link rel="prefetch" href="/handover/assets/js/30.7ea85f4b.js"><link rel="prefetch" href="/handover/assets/js/31.40c66dac.js"><link rel="prefetch" href="/handover/assets/js/32.94771c91.js"><link rel="prefetch" href="/handover/assets/js/33.baa8703b.js"><link rel="prefetch" href="/handover/assets/js/34.2fbd4503.js"><link rel="prefetch" href="/handover/assets/js/35.49bb5a1f.js"><link rel="prefetch" href="/handover/assets/js/36.ca6640bf.js"><link rel="prefetch" href="/handover/assets/js/37.dc0cb2f1.js"><link rel="prefetch" href="/handover/assets/js/4.a98ae983.js"><link rel="prefetch" href="/handover/assets/js/5.3222be7e.js"><link rel="prefetch" href="/handover/assets/js/6.2f528cd8.js"><link rel="prefetch" href="/handover/assets/js/7.e7c21d4d.js"><link rel="prefetch" href="/handover/assets/js/8.dac3de63.js"><link rel="prefetch" href="/handover/assets/js/9.50eac6c0.js">
    <link rel="stylesheet" href="/handover/assets/css/0.styles.f8d78339.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/handover/" class="home-link router-link-active"><!----> <span class="site-name">交接文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/handover/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/handover/01/" class="nav-link">
  服务器相关
</a></div><div class="nav-item"><a href="/handover/02/" class="nav-link">
  代码相关
</a></div><div class="nav-item"><a href="/handover/03/" class="nav-link router-link-active">
  运维相关
</a></div><div class="nav-item"><a href="/handover/04/" class="nav-link">
  其他
</a></div> <a href="https://github.com/strugglingbird/handover" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/handover/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/handover/01/" class="nav-link">
  服务器相关
</a></div><div class="nav-item"><a href="/handover/02/" class="nav-link">
  代码相关
</a></div><div class="nav-item"><a href="/handover/03/" class="nav-link router-link-active">
  运维相关
</a></div><div class="nav-item"><a href="/handover/04/" class="nav-link">
  其他
</a></div> <a href="https://github.com/strugglingbird/handover" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>负载均衡器的使用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/handover/03/09/#配置负载均衡实例" class="sidebar-link">配置负载均衡实例</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/handover/03/09/#配置服务器组" class="sidebar-link">配置服务器组</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/handover/03/09/#配置健康检查" class="sidebar-link">配置健康检查</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/handover/03/09/#证书管理" class="sidebar-link">证书管理</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="负载均衡器的使用"><a href="#负载均衡器的使用" class="header-anchor">#</a> 负载均衡器的使用</h1> <p>负载均衡器一般用于对阿里云内部所有部署的应用进行单独的路由负载（包括ESC和K8S部署的应用）即网关入口，并对外暴露一个高可用的负载地址。</p> <blockquote><p>这里面引用了一个现实的场景需求：</p> <p>千瓣莲商城这个应用需要通过负载均衡单独配置外部的访问入口，并且这个项目同时部署在ECS和K8S中，之所以这么做主要就是防止任意一方出现故障可以做到及时切换。</p></blockquote> <h2 id="配置负载均衡实例"><a href="#配置负载均衡实例" class="header-anchor">#</a> 配置负载均衡实例</h2> <p>1.切换到菜单栏找到负载均衡应用</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe8o8zzv9j31l60u0q7t.jpg" alt="image-20211215090136926"></p> <p>2.进入到实例一般通过点击创建实例就可以看到下方的实力列表了（这里我们就略掉实例的创建方式，主要看如何配置实例的负载规则）</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe8xzrupej31vq0u0q70.jpg" alt="image-20211215091058485"></p> <p>3.配置实例的负载规则</p> <p>3.1 创建玩实例之后点击进入实例详情并切换到监听选项</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe91xh6rgj31uf0u041o.jpg" alt="image-20211215091445777"></p> <p>3.2 这里我们是https访问因此监听的端口肯定是443</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe939m8eej31rq0u0juk.jpg" alt="image-20211215091602363"></p> <p>3.3 这里我们选择一个服务器组，如果没有点击创建并<a href="#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%84">配置服务器组</a></p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe94d091mj328s0tewhe.jpg" alt="image-20211215091706109"></p> <p>3.4 配置玩服务器组提交配置即可</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxeaqve1ayj31h60u042c.jpg" alt="image-20211215101319960"></p> <p>3.5 提交完便出现一条监听实例</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxearlz39ej328y0d2n08.jpg" alt="image-20211215101403660"></p> <p>3.6 编辑规则</p> <p>点击查看/编辑转发规则</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxeawe0ehqj329e0iejul.jpg" alt="image-20211215101838761"></p> <p>这里会出现一个默认配置，一般不用改改动，如果有特殊的路由规则可以添加配置（类似nginx的路由配置）</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxeax07tdpj321c0u0wiy.jpg" alt="image-20211215101914123"></p> <p>3.7 管理证书</p> <p>管理证书一般是针对https访问时需要我们配置域名证书，来保证https可以正常访问</p> <p>点击管理证书</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxeay8ix69j329e0i2whm.jpg" alt="image-20211215102025203"></p> <p>点击添加扩展证书，选择一配置好的证书（详细配置请参考<a href="#%E8%AF%81%E4%B9%A6%E7%AE%A1%E7%90%86">证书管理</a>）</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxebc1cucrj31nt0u00w3.jpg" alt="image-20211215103341050"></p> <p>点击确定即可</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxebckyv3xj327o0u0tc8.jpg" alt="image-20211215103412330"></p> <h2 id="配置服务器组"><a href="#配置服务器组" class="header-anchor">#</a> 配置服务器组</h2> <p>服务器组，一般是用于配置被负载的一群集群的后端应用服务，在这里我们可以配置ECS或者K8S中部署的应用</p> <p>进入服务器组页面点击创建服务器组</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxea2te2ygj31q30u0wh8.jpg" alt="image-20211215095013403"></p> <p>配置基本信息</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxea6kl8srj30u00yp0u6.jpg" alt="image-20211215095349763"></p> <p>配置健康检查</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxea7gfydyj30u00yy403.jpg" alt="image-20211215095440787"></p> <p>这里我们选择已经创建好的健康检查规则，具体配置规则请参考<a href="#%E9%85%8D%E7%BD%AE%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5">配置健康检查</a></p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxea8m41tyj30yn0u0dhs.jpg" alt="image-20211215095547776"></p> <p>点击创建后，便可看到一条服务器组记录</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxea9waerzj31xs0u041y.jpg" alt="image-20211215095700460"></p> <p>配置后端服务器</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxeab4mndkj329m0fqju6.jpg" alt="image-20211215095812682"></p> <p>选择需要添加的节点，这里我们选择分别部署在ECS和K8S中的商城应用所属的两组类别服务器节点</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxeagawkovj31oh0u0tem.jpg" alt="image-20211215100309805"></p> <p>配置负载的端口的权重</p> <p>这里我们在k8s中配置服务的暴露端口是30250，而在ECS单机节点部署暴露的端口是8050，并且对K8S的服务访问权重为100，对ECS单机节点服务访问权重为0，即我们的访问流量会100%的命中K8S节点上，而ECS单机部署节点则不会被命中。</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxeahjfezkj328s0osjw2.jpg" alt="image-20211215100422018"></p> <h2 id="配置健康检查"><a href="#配置健康检查" class="header-anchor">#</a> 配置健康检查</h2> <p>健康检查一般主要是解决后端服务节点不可用时，我们的流量不会被负载到这种不可用的节点，这样即使某个节点挂掉之后我们的应用仍然不会收到影响。</p> <p>进入健康检查页面点击创建健康检查</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxeani0eloj31s30u0q59.jpg" alt="image-20211215101005362"></p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxebdw956bj30tk13wdi5.jpg" alt="image-20211215103528353"></p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxebemr8e9j30tg166mzl.jpg" alt="image-20211215103610520"></p> <h2 id="证书管理"><a href="#证书管理" class="header-anchor">#</a> 证书管理</h2> <p>证书一般用于负载实例监听配置了https访问，需要提在这里配置好的证书</p> <p>点击进入证书管理 -&gt; 创建证书</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxebh4n6abj31p50u0dje.jpg" alt="image-20211215103833961"></p> <blockquote><p>TIPS:</p> <p>1.如果是阿里云证书并且所属当前阿里云账号直接选择阿里云颁发证书即可，如果是非该账号下的证书选择上传非阿里云签发证书。</p> <p>2.上传非阿里云签发证书上传nginx证书类型的公钥和私钥创建即可</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/handover/assets/js/app.0bd4e087.js" defer></script><script src="/handover/assets/js/2.40eece3a.js" defer></script><script src="/handover/assets/js/17.f8650417.js" defer></script>
  </body>
</html>
