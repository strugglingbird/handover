<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>容器服务Kubernetes的使用 | 交接文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/handover/hero.svg">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/handover/assets/css/0.styles.f8d78339.css" as="style"><link rel="preload" href="/handover/assets/js/app.0bd4e087.js" as="script"><link rel="preload" href="/handover/assets/js/2.40eece3a.js" as="script"><link rel="preload" href="/handover/assets/js/16.eb5b5be5.js" as="script"><link rel="prefetch" href="/handover/assets/js/10.272653f1.js"><link rel="prefetch" href="/handover/assets/js/11.742c26f2.js"><link rel="prefetch" href="/handover/assets/js/12.18bc48d7.js"><link rel="prefetch" href="/handover/assets/js/13.c69daf34.js"><link rel="prefetch" href="/handover/assets/js/14.f032ed61.js"><link rel="prefetch" href="/handover/assets/js/15.62f784ac.js"><link rel="prefetch" href="/handover/assets/js/17.f8650417.js"><link rel="prefetch" href="/handover/assets/js/18.dfedbf20.js"><link rel="prefetch" href="/handover/assets/js/19.f7e0f19b.js"><link rel="prefetch" href="/handover/assets/js/20.3ea0f030.js"><link rel="prefetch" href="/handover/assets/js/21.6b415d81.js"><link rel="prefetch" href="/handover/assets/js/22.fe44f683.js"><link rel="prefetch" href="/handover/assets/js/23.35da1f9e.js"><link rel="prefetch" href="/handover/assets/js/24.e4da81e8.js"><link rel="prefetch" href="/handover/assets/js/25.53623594.js"><link rel="prefetch" href="/handover/assets/js/26.27a315c6.js"><link rel="prefetch" href="/handover/assets/js/27.2c96ed45.js"><link rel="prefetch" href="/handover/assets/js/28.7e031f1e.js"><link rel="prefetch" href="/handover/assets/js/29.e8295554.js"><link rel="prefetch" href="/handover/assets/js/3.dd08ab77.js"><link rel="prefetch" href="/handover/assets/js/30.7ea85f4b.js"><link rel="prefetch" href="/handover/assets/js/31.40c66dac.js"><link rel="prefetch" href="/handover/assets/js/32.94771c91.js"><link rel="prefetch" href="/handover/assets/js/33.baa8703b.js"><link rel="prefetch" href="/handover/assets/js/34.2fbd4503.js"><link rel="prefetch" href="/handover/assets/js/35.49bb5a1f.js"><link rel="prefetch" href="/handover/assets/js/36.ca6640bf.js"><link rel="prefetch" href="/handover/assets/js/37.dc0cb2f1.js"><link rel="prefetch" href="/handover/assets/js/4.a98ae983.js"><link rel="prefetch" href="/handover/assets/js/5.3222be7e.js"><link rel="prefetch" href="/handover/assets/js/6.2f528cd8.js"><link rel="prefetch" href="/handover/assets/js/7.e7c21d4d.js"><link rel="prefetch" href="/handover/assets/js/8.dac3de63.js"><link rel="prefetch" href="/handover/assets/js/9.50eac6c0.js">
    <link rel="stylesheet" href="/handover/assets/css/0.styles.f8d78339.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/handover/" class="home-link router-link-active"><!----> <span class="site-name">交接文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/handover/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/handover/01/" class="nav-link">
  服务器相关
</a></div><div class="nav-item"><a href="/handover/02/" class="nav-link">
  代码相关
</a></div><div class="nav-item"><a href="/handover/03/" class="nav-link router-link-active">
  运维相关
</a></div><div class="nav-item"><a href="/handover/04/" class="nav-link">
  其他
</a></div> <a href="https://github.com/strugglingbird/handover" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/handover/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/handover/01/" class="nav-link">
  服务器相关
</a></div><div class="nav-item"><a href="/handover/02/" class="nav-link">
  代码相关
</a></div><div class="nav-item"><a href="/handover/03/" class="nav-link router-link-active">
  运维相关
</a></div><div class="nav-item"><a href="/handover/04/" class="nav-link">
  其他
</a></div> <a href="https://github.com/strugglingbird/handover" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>容器服务Kubernetes的使用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/handover/03/08/#节点扩容" class="sidebar-link">节点扩容</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/handover/03/08/#应用管理" class="sidebar-link">应用管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/handover/03/08/#创建应用" class="sidebar-link">创建应用</a></li><li class="sidebar-sub-header"><a href="/handover/03/08/#更新应用" class="sidebar-link">更新应用</a></li><li class="sidebar-sub-header"><a href="/handover/03/08/#版本回退" class="sidebar-link">版本回退</a></li><li class="sidebar-sub-header"><a href="/handover/03/08/#日志查询" class="sidebar-link">日志查询</a></li><li class="sidebar-sub-header"><a href="/handover/03/08/#容器扩缩" class="sidebar-link">容器扩缩</a></li></ul></li><li><a href="/handover/03/08/#证书配置" class="sidebar-link">证书配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/handover/03/08/#域名配置" class="sidebar-link">域名配置</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="容器服务kubernetes的使用"><a href="#容器服务kubernetes的使用" class="header-anchor">#</a> 容器服务Kubernetes的使用</h1> <p>打开阿里云选择【<code>容器服务Kubernetes版</code>】并进入</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxdgz7csroj311d0u0ado.jpg" alt="image-20211214170320008"></p> <h2 id="节点扩容"><a href="#节点扩容" class="header-anchor">#</a> 节点扩容</h2> <p>进入<code>集群</code> -&gt; <code>节点管理</code> -&gt; <code>节点</code> -&gt; <code>集群扩容</code></p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxdh3wu3ixj31oq0u0teg.jpg" alt="image-20211214170753951"></p> <h2 id="应用管理"><a href="#应用管理" class="header-anchor">#</a> 应用管理</h2> <h3 id="创建应用"><a href="#创建应用" class="header-anchor">#</a> 创建应用</h3> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxdhx9ny54j31te0u0wit.jpg" alt="image-20211214173606897"></p> <p>配置参数请参考下图：</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7br4q9tj30u01l9n17.jpg" alt="image-20211215081457106"></p> <h3 id="更新应用"><a href="#更新应用" class="header-anchor">#</a> 更新应用</h3> <p>更新应用一般都是通过云效Devops的流水线来发布新版本应用</p> <p>1.打开<a href="https://flow.aliyun.com/my" target="_blank" rel="noopener noreferrer">云效Devops<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7er2887j32l40o8ae8.jpg" alt="image-20211215081752904"></p> <p>2.对于已创建的流水线在更新代码后直接点击运行即可</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7hxhq25j32l80mc78l.jpg" alt="image-20211215082056413"></p> <p>3.对于未创建的流水线则需要我们创建一个新的流水线</p> <p>点击新建流水线</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7iee3uvj32la0n4jvn.jpg" alt="image-20211215082124195"></p> <p>任选一个企业模版</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7kkvw5pj31rt0u0q7y.jpg" alt="image-20211215082329541"></p> <p>以后端模版为例</p> <p>配置代码库</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7mxqm4rj31lu0u077i.jpg" alt="image-20211215082544446"></p> <p>配置docker推送的景象仓库</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7omi2ogj31li0u0diu.jpg" alt="image-20211215082722519"></p> <p>配置kubectl发布参数</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7proi1uj31lk0u0770.jpg" alt="image-20211215082828780"></p> <p>配置完成之后点击保存并运行</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7qgqd3vj32kl0u077k.jpg" alt="image-20211215082909014"></p> <h3 id="版本回退"><a href="#版本回退" class="header-anchor">#</a> 版本回退</h3> <p>找到工作负载，点击应用 -&gt; 更多 -&gt; 回滚</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7rmc3tuj31xc0u00xv.jpg" alt="image-20211215083015191"></p> <p>找到对应的版本号点击回滚即可</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7t2ls4kj31l50u0443.jpg" alt="image-20211215083139549"></p> <h3 id="日志查询"><a href="#日志查询" class="header-anchor">#</a> 日志查询</h3> <p>进入应用详情页</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7ui6ctoj320h0u0q7x.jpg" alt="image-20211215083301816"></p> <p>切换到日志选项即可</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe7vaz7rkj31kz0u07de.jpg" alt="image-20211215083348052"></p> <h3 id="容器扩缩"><a href="#容器扩缩" class="header-anchor">#</a> 容器扩缩</h3> <p>1.临时方案（简单快捷，持久化方案不建议使用，因为一旦应用更新便会回到原来的副本数量）</p> <p>点击伸缩</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe8069huaj32l20to7b0.jpg" alt="image-20211215083828754"></p> <p>输入副本数量</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe80tpxiej32ep0u0n3j.jpg" alt="image-20211215083906017"></p> <p>2.持久化方案（可用于长期策略，永久生效，需要配置代码）</p> <p>找到项目的配置文件，修改代码中的副本数量，最后再进行<a href="#%E6%9B%B4%E6%96%B0%E5%BA%94%E7%94%A8">更新应用</a></p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe84owa2sj326i0u0gqt.jpg" alt="image-20211215084249185"></p> <h2 id="证书配置"><a href="#证书配置" class="header-anchor">#</a> 证书配置</h2> <p>一般我们项目API的域名证书即将到期之后需要重新配置新的证书</p> <p>点击配置管理 -&gt; 密保字典</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe8a39lr3j32l80s6te0.jpg" alt="image-20211215084800906"></p> <p>输入域名和nginx证书的cert和key</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe8bby2aqj32l80t4wl9.jpg" alt="image-20211215084912598"></p> <h2 id="域名配置"><a href="#域名配置" class="header-anchor">#</a> 域名配置</h2> <p>域名配置一般是用于暴露服务的外部访问</p> <p>点击网络 -&gt; 路由 -&gt; 创建</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe8g84l7rj32la0py0yc.jpg" alt="image-20211215085353726"></p> <p>配置域名、路径、服务和证书之后即可</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gxe8iet2emj30u00xz413.jpg" alt="image-20211215085600074"></p> <blockquote><p>这里需要注意的是下方有个注解，一般不用配置，但这个也很重要，主要是设置k8s内部nginx的访问策略，比如这里就是设置代理访问的重定向路由策略（http://ma.ecolovo.com/api/xxx -&gt; http://qbl-admin-svc/xxx）</p> <p>具体规则请参考：</p> <p><a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/?spm=a2c4g.11186623.0.0.6d477faaPuHmVz" target="_blank" rel="noopener noreferrer">Annotations<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/handover/assets/js/app.0bd4e087.js" defer></script><script src="/handover/assets/js/2.40eece3a.js" defer></script><script src="/handover/assets/js/16.eb5b5be5.js" defer></script>
  </body>
</html>
