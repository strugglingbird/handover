(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{410:function(s,a,e){"use strict";e.r(a);var t=e(29),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"节点磁盘不够用时如何处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#节点磁盘不够用时如何处理"}},[s._v("#")]),s._v(" 节点磁盘不够用时如何处理")]),s._v(" "),e("h2",{attrs:{id:"一、清理或迁移docker的存储目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、清理或迁移docker的存储目录"}},[s._v("#")]),s._v(" 一、清理或迁移docker的存储目录")]),s._v(" "),e("blockquote",[e("p",[s._v("docker用起来简单，但是要用到实际线上业务当中细节问题往往影响整个系统的稳定，比如docker容器在物理机上的数据卷问题。docker默认的根目录是/var/lib/docker，容器使用一段时间后会发现该目录所占磁盘会非常大，小到几个G，大到上百G，而/var/lib/docker所在的分区往往不大，此时就需要将该目录迁移到一个物理空间比较大的分区中，并修改docker的默认根目录。")])]),s._v(" "),e("p",[s._v("具体步骤如下：")]),s._v(" "),e("h3",{attrs:{id:"查看磁盘使用情况"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看磁盘使用情况"}},[s._v("#")]),s._v(" 查看磁盘使用情况")]),s._v(" "),e("p",[s._v("查看磁盘使用情况")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rancher-node2 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# du -hs /var/lib/docker/")]),s._v("\n47G\t/var/lib/docker/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("查看Docker的磁盘使用情况")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rancher-node2 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker system df")]),s._v("\nTYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE\nImages          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".661GB   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".789GB "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nContainers      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("181")]),s._v(".9kB   0B "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nLocal Volumes   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v(".36MB   0B "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nBuild Cache     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         0B        0B\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"停止docker服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#停止docker服务"}},[s._v("#")]),s._v(" 停止docker服务")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl stop docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"创建新的docker目录并迁移原有数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建新的docker目录并迁移原有数据"}},[s._v("#")]),s._v(" 创建新的docker目录并迁移原有数据")]),s._v(" "),e("p",[s._v("执行命令df -h,找一个大的磁盘。 我在 /home目录下面建了 /home/docker/lib目录，执行的命令是：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /home/docker/lib\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("迁移/var/lib/docker目录下面的文件到 /home/docker/lib：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r /var/lib/docker /home/docker/lib/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"修改存储配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改存储配置"}},[s._v("#")]),s._v(" 修改存储配置")]),s._v(" "),e("h3",{attrs:{id:"docker-版本-v17-05-0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-版本-v17-05-0"}},[s._v("#")]),s._v(" Docker 版本 >= v17.05.0")]),s._v(" "),e("p",[s._v("因为 Docker 官方在这个发行版本就 deprecated 了 "),e("code",[s._v("graph")]),s._v(" 这个 feature，所以如果你机器上安装的 Docker 版本 >= v17.05.0，则无法通过在 "),e("code",[s._v("/etc/default/docker")]),s._v(" 配置文件中指定 "),e("code",[s._v("graph")]),s._v(" 参数来修改 Docker 的默认安装(存储)目录了，具体参见官网文档："),e("a",{attrs:{href:"https://link.ld246.com/forward?goto=https%3A%2F%2Fdocs.docker.com%2Fengine%2Fdeprecated%2F%23-g-and---graph-flags-on-dockerd",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Docs"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("p",[s._v("好在天无绝人之路，新版本的 Docker 还有其他方式可以达到我们修改安装(存储)目录的目的：通过修改(新建)"),e("code",[s._v("/etc/docker/daemon.json")]),s._v("，指定 "),e("code",[s._v("data-root")]),s._v(" 参数的值。")]),s._v(" "),e("p",[s._v("按如下操作：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/docker/daemon.json\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("加入")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data-root"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/docker/lib"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"重启-docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启-docker"}},[s._v("#")]),s._v(" 重启 Docker")]),s._v(" "),e("p",[s._v("最后，重启 Docker 服务：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" docker restart\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"检查"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检查"}},[s._v("#")]),s._v(" 检查")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker info\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Docker Root Dir: /data/docker/lib/docker\n执行"),e("code",[s._v("docker images")]),s._v("可以看到之前所有的镜像也全部同步了过来")]),s._v(" "),e("h2",{attrs:{id:"二、扩容磁盘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、扩容磁盘"}},[s._v("#")]),s._v(" 二、扩容磁盘")]),s._v(" "),e("p",[s._v("详情请移步参考"),e("RouterLink",{attrs:{to:"/04/13/"}},[s._v("CentOS7如何给磁盘扩容")])],1)])}),[],!1,null,null,null);a.default=r.exports}}]);