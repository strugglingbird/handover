(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{400:function(s,a,t){"use strict";t.r(a);var e=t(29),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用rancher搭建kubenetes高可用集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用rancher搭建kubenetes高可用集群"}},[s._v("#")]),s._v(" 使用rancher搭建kubenetes高可用集群")]),s._v(" "),t("h2",{attrs:{id:"配置清单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置清单"}},[s._v("#")]),s._v(" 配置清单")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("hostname")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("ip")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("配置")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("rancher-lb")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.0.80")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("2核2G")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("rancher-node1")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.0.81")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("2核4G")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("rancher-node2")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.0.82")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("2核4G")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("rancher-node3")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.0.83")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("2核4G")])])])]),s._v(" "),t("blockquote",[t("p",[s._v("以上配置为最低要求配置，实际情况可按需求添加配置或伸缩节点，rancher-node最少可为1个节点，其中安装etcd节点最好为奇数节点，否则会出现脑裂。")])]),s._v(" "),t("h2",{attrs:{id:"环境初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境初始化"}},[s._v("#")]),s._v(" 环境初始化")]),s._v(" "),t("p",[s._v("所有机器都要执行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭selinux")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/'")]),s._v(" /etc/selinux/config  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久")]),s._v("\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭swap")]),s._v("\nswapoff -a  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -ri "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据规划设置主机名")]),s._v("\nhostnamectl set-hostname k8s-master1\n\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" -y\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改yum源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/yum.repos.d/ \n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mirrors.163.com/.help/CentOS7-Base-163.repo\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" CentOS-Base.repo CentOS-Base.repo.bak\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" CentOS7-Base-163.repo CentOS-Base.repo\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置kubernetes源")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n\nyum clean all \n\nyum makecache \n\nyum update -y\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装docker")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step 1: 安装必要的一些系统工具")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step 2: 添加软件源信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step 3: 更新并安装 Docker-CE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum makecache fast\n\nyum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce-19.03.12-3.el7\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Step 4: 开启Docker服务")]),s._v("\nsystemctl start docker\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改docker镜像源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'EOF\'\n{\n  "data-root": "/home/docker",\n  "registry-mirrors": ["https://q8tek117.mirror.aliyuncs.com"]\n}\nEOF')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动docker")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br")])]),t("h4",{attrs:{id:"授权lb节点免密登陆其他节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#授权lb节点免密登陆其他节点"}},[s._v("#")]),s._v(" 授权lb节点免密登陆其他节点")]),s._v(" "),t("p",[s._v("Lb 节点执行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成私钥和公钥，一路回车")]),s._v("\nssh-keygen -t rsa -b "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分发公钥到其他节点")]),s._v("\nssh-copy-id -i root@192.168.100.81\nssh-copy-id -i root@192.168.100.82\nssh-copy-id -i root@192.168.100.83\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"添加用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加用户"}},[s._v("#")]),s._v(" 添加用户")]),s._v(" "),t("p",[s._v("非lb的其他节点执行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加docker用户并添加至docker用户组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g docker docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r /root/.ssh /home/docker/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R docker:docker /home/docker/.ssh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[t("strong",[s._v("注意:")]),s._v(" 这个步骤一定不能与上个步骤顺序执行相反，否则docker用户无法免密登陆")])]),s._v(" "),t("h2",{attrs:{id:"配置lb节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置lb节点"}},[s._v("#")]),s._v(" 配置lb节点")]),s._v(" "),t("p",[s._v("该节点不是必须节点，云厂商可以使用负载均衡器")]),s._v(" "),t("h3",{attrs:{id:"预先准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#预先准备"}},[s._v("#")]),s._v(" 预先准备")]),s._v(" "),t("h4",{attrs:{id:"上传安装文件-rke、helm、cert-manager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上传安装文件-rke、helm、cert-manager"}},[s._v("#")]),s._v(" 上传安装文件（rke、helm、cert-manager）")]),s._v(" "),t("p",[s._v("链接: https://pan.baidu.com/s/1N_tJ9aNsr-O6jd5OtlnvUw  密码: q68u")]),s._v(" "),t("p",[s._v("下载后并上传")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rke-lb rke-install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/root/rke-install\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rke-lb rke-install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\ncert-manager  helm-v3.3.0-linux-amd64.tar.gz  rke_linux-amd64\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将镜像分发到其他镜像，待其他节点安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" cert-manager\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" cert-manager*.gz root@192.168.100.81:\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" cert-manager*.gz root@192.168.100.82:\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" cert-manager*.gz root@192.168.100.83:\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"安装nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx"}},[s._v("#")]),s._v(" 安装nginx")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rpm")]),s._v(" -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n\nyum install nginx -y\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑配置文件")]),s._v("\nrm -rf /etc/nginx/nginx.conf\nvi /etc/nginx/nginx.conf\n\n\nworker_processes "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_rlimit_nofile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40000")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("stream")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" rancher_servers_http")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("least_conn")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.100.81:80 max_fails=3 fail_timeout=5s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.100.82:80 max_fails=3 fail_timeout=5s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.100.83:80 max_fails=3 fail_timeout=5s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" rancher_servers_http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" rancher_servers_https")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("least_conn")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.100.81:443 max_fails=3 fail_timeout=5s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.100.82:443 max_fails=3 fail_timeout=5s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.100.83:443 max_fails=3 fail_timeout=5s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" rancher_servers_https")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动nginx")]),s._v("\nsudo systemctl daemon-reload\nsudo systemctl restart nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("h3",{attrs:{id:"安装kukectl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装kukectl"}},[s._v("#")]),s._v(" 安装kukectl")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kubectl -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"安装helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装helm"}},[s._v("#")]),s._v(" 安装helm")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /root/rke-install\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf  helm-v3.2.4-linux-amd64.tar.gz\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" linux-amd64/helm /usr/local/bin\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 Helm Chart 仓库")]),s._v("\nhelm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" rancher-stable https://releases.rancher.com/server-charts/stable\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"开始安装k8s集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始安装k8s集群"}},[s._v("#")]),s._v(" 开始安装k8s集群")]),s._v(" "),t("p",[s._v("以下操作均在lb节点上执行")]),s._v(" "),t("h4",{attrs:{id:"编辑配置文件-并保存命名为rancher-cluster-yml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编辑配置文件-并保存命名为rancher-cluster-yml"}},[s._v("#")]),s._v(" 编辑配置文件，并保存命名为"),t("code",[s._v("rancher-cluster.yml")])]),s._v(" "),t("p",[s._v("将"),t("code",[s._v("nodes")]),s._v("列表中的"),t("code",[s._v("address")]),s._v("和"),t("code",[s._v("internal_address")]),s._v(" 替换为您创建的 3 个节点的 IP 地址或 DNS 名称")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.100.81\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("internal_address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.100.81\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("controlplane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" worker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" etcd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.100.82\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("internal_address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.100.82\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("controlplane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" worker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" etcd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.100.83\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("internal_address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.100.83\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("controlplane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" worker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" etcd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("etcd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("snapshot")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creation")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 6h\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retention")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 24h\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("blockquote",[t("p",[s._v("TIPS:")]),s._v(" "),t("p",[s._v("如果在执行上面的命令之前检查过命令的话会发现三台node都创建了一个名为docker的用户，并且用户组为docker，这是因为centos的docker是以root用户运行的，但rke的安装不能用root用户来执行命令。所以需要建立一个用户，并将其加入docker组，而这个用户可以实其他名字而不一定为docker")]),s._v(" "),t("p",[t("strong",[s._v("注意事项:")]),s._v(" 如果您的节点具有公网和内网地址，建议在"),t("code",[s._v("internal_address")]),s._v("一栏输入内网地址，以便 Kubernetes 将其用于集群内部通信。如果使用自身安全组或防火墙，则某些云服务供应商强制要求设置 "),t("code",[s._v("internal_address:")])]),s._v(" "),t("h3",{attrs:{id:"rke-节点通用选项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rke-节点通用选项"}},[s._v("#")]),s._v(" RKE 节点通用选项")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("选项")]),s._v(" "),t("th",[s._v("是否必选")]),s._v(" "),t("th",[s._v("描述")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("address")])]),s._v(" "),t("td",[s._v("是")]),s._v(" "),t("td",[s._v("公共 DNS 或 IP 地址")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("user")])]),s._v(" "),t("td",[s._v("是")]),s._v(" "),t("td",[s._v("可以执行 docker 命令的用户")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("role")])]),s._v(" "),t("td",[s._v("是")]),s._v(" "),t("td",[s._v("给节点分配的 Kubernetes 角色列表")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("internal_address")])]),s._v(" "),t("td",[s._v("否")]),s._v(" "),t("td",[s._v("给集群内部流量使用的私有 DNS 或者 IP 地址")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("ssh_key_path")])]),s._v(" "),t("td",[s._v("否")]),s._v(" "),t("td",[s._v("用来登录节点的 SSH 私钥路径 ，默认值为 "),t("code",[s._v("~/.ssh/id_rsa")])])])])])]),s._v(" "),t("h4",{attrs:{id:"运行-rke"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行-rke"}},[s._v("#")]),s._v(" 运行 RKE")]),s._v(" "),t("p",[s._v("输入以下命令，运行 RKE 节点。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /root/rke-install\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" rke_linux-amd64 rke\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x rke\n./rke up --config ./rancher-cluster.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("运行结束后返回 "),t("code",[s._v("Finished building Kubernetes cluster successfully")]),s._v("，表示正常运行。")]),s._v(" "),t("h4",{attrs:{id:"存放kubectl配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存放kubectl配置文件"}},[s._v("#")]),s._v(" 存放kubectl配置文件")]),s._v(" "),t("p",[s._v("接下来要将kube_config_rancher-cluster.yml放置到指定位置，使kubectl能够正常访问kubenetes集群")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" kube_config_rancher-cluster.yml "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("验证并检查所有Pods的情况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get pods --all-namespaces\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"安装rancher"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装rancher"}},[s._v("#")]),s._v(" 安装Rancher")]),s._v(" "),t("h3",{attrs:{id:"安装方式选择"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装方式选择"}},[s._v("#")]),s._v(" 安装方式选择")]),s._v(" "),t("p",[s._v("Rancher安装默认需要 SSL/TLS 配置来保证访问的安全性，因此在安装前需要确定你使用哪一种证书安装方式，一般由以下2种证书安装方式，两种方式2选1即可。")]),s._v(" "),t("ul",[t("li",[s._v("方案一： 由Rancher生成证书安装")]),s._v(" "),t("li",[s._v("方案二： 用自己已有的证书安装")])]),s._v(" "),t("p",[s._v("方案对比：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("设置")]),s._v(" "),t("th",[s._v("Chart 选项")]),s._v(" "),t("th",[s._v("描述")]),s._v(" "),t("th",[s._v("是否需要 cert-manager")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("a",{attrs:{href:"https://rancher2.docs.rancher.cn/docs/installation/options/helm2/helm-rancher/_index#rancher-%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6",target:"_blank",rel:"noopener noreferrer"}},[s._v("Rancher 自签名证书"),t("OutboundLink")],1)]),s._v(" "),t("td",[t("code",[s._v("ingress.tls.source=rancher")])]),s._v(" "),t("td",[s._v("使用 Rancher 生成的 CA 签发的自签名证书 此项为"),t("strong",[s._v("默认选项")])]),s._v(" "),t("td",[t("a",{attrs:{href:"https://rancher2.docs.rancher.cn/docs/installation/options/helm2/helm-rancher/_index#%E9%80%89%E8%A3%85%EF%BC%9A%E5%AE%89%E8%A3%85-cert-manager",target:"_blank",rel:"noopener noreferrer"}},[s._v("是"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://rancher2.docs.rancher.cn/docs/installation/options/helm2/helm-rancher/_index#lets-encrypt",target:"_blank",rel:"noopener noreferrer"}},[s._v("Let’s Encrypt"),t("OutboundLink")],1)]),s._v(" "),t("td",[t("code",[s._v("ingress.tls.source=letsEncrypt")])]),s._v(" "),t("td",[s._v("使用"),t("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Let's Encrypt"),t("OutboundLink")],1),s._v("颁发的证书")]),s._v(" "),t("td",[t("a",{attrs:{href:"https://rancher2.docs.rancher.cn/docs/installation/options/helm2/helm-rancher/_index#%E9%80%89%E8%A3%85%EF%BC%9A%E5%AE%89%E8%A3%85-cert-manager",target:"_blank",rel:"noopener noreferrer"}},[s._v("是"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://rancher2.docs.rancher.cn/docs/installation/options/helm2/helm-rancher/_index#%E6%82%A8%E5%B7%B2%E6%9C%89%E7%9A%84%E8%AF%81%E4%B9%A6",target:"_blank",rel:"noopener noreferrer"}},[s._v("您已有的证书"),t("OutboundLink")],1)]),s._v(" "),t("td",[t("code",[s._v("ingress.tls.source=secret")])]),s._v(" "),t("td",[s._v("使用您的已有证书（Kubernetes 密文）")]),s._v(" "),t("td",[s._v("否")])])])]),s._v(" "),t("blockquote",[t("p",[s._v("仅由 Rancher 生成的 CA "),t("code",[s._v("ingress.tls.source=rancher")]),s._v(" 和 Let's Encrypt 颁发的证书 "),t("code",[s._v("ingress.tls.source=letsEncrypt")]),s._v(" 才需要 cert-manager。如果您使用自己的证书文件 "),t("code",[s._v("ingress.tls.source=secret")]),s._v(" 或者"),t("a",{attrs:{href:"https://rancher2.docs.rancher.cn/docs/installation/options/helm2/helm-rancher/chart-options/_index#%E5%A4%96%E9%83%A8-tls-termination",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用外部 TLS 负载均衡器"),t("OutboundLink")],1),s._v("可以不需要[安装cert-manager](#安装 cert-manager)。")])]),s._v(" "),t("h3",{attrs:{id:"方案一-由rancher生成证书安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方案一-由rancher生成证书安装"}},[s._v("#")]),s._v(" 方案一：由Rancher生成证书安装")]),s._v(" "),t("h4",{attrs:{id:"安装-cert-manager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-cert-manager"}},[s._v("#")]),s._v(" 安装 cert-manager")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("单独安装 CustomResourceDefinition 资源")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl apply -f cert-manager.crds.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("为 cert-manager 创建命名空间")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl create namespace cert-manager\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("标记 cert-manager 命名空间，禁用资源验证")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl label namespace cert-manager certmanager.k8s.io/disable-validation"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("添加 Jetstack Helm repository")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" jetstack https://charts.jetstack.io\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("更新本地的 Helm chart repository 缓存")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("helm repo update\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("加载helm安装cert-manager时所需要的docker镜像")]),s._v(" "),t("p",[s._v("在所有非lb节点执行以下命令，如果是科学上网可忽略此步骤")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker load -i cert-manager-webhook.tar.gz\n\ndocker load -i cert-manager-cainjector.tar.gz\n\ndocker load -i cert-manager.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("使用 Helm chart 安装 cert-manager")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  cert-manager "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  jetstack/cert-manager "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --namespace cert-manager "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --version v0.13.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("安装 cert-manager 以后，您可以通过检查 cert-manager 命名空间下的 pod 运行状态来验证部署是否正确：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get pods --namespace cert-manager\n\nNAME                                            READY   STATUS      RESTARTS   AGE\ncert-manager-7cbdc48784-rpgnt                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m\ncert-manager-webhook-5b5dd6999-kst4x            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m\ncert-manager-cainjector-3ba5cd2bcd-de332x       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])]),s._v(" "),t("h4",{attrs:{id:"rancher安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rancher安装"}},[s._v("#")]),s._v(" rancher安装")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建命名空间")]),s._v("\nkubectl create namespace cattle-system\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\nhelm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  rancher "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  rancher-stable/rancher "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --namespace cattle-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("k8s.ecolovo.icu\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("blockquote",[t("p",[s._v("TIPS:")]),s._v(" "),t("p",[s._v("将hostname替换成解析道lb节点的域名地址")])]),s._v(" "),t("h3",{attrs:{id:"方案二-用自己已有的证书安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方案二-用自己已有的证书安装"}},[s._v("#")]),s._v(" 方案二：用自己已有的证书安装")]),s._v(" "),t("h4",{attrs:{id:"添加-kubernetes-tls-密文"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加-kubernetes-tls-密文"}},[s._v("#")]),s._v(" 添加 Kubernetes TLS 密文")]),s._v(" "),t("p",[t("strong",[s._v("申请颁发证书")])]),s._v(" "),t("p",[s._v("阿里云证书一般选择下载tomcat类型证书，下载解压后会得到"),t("code",[s._v("xxx_domain.pfx")]),s._v("和"),t("code",[s._v("pfx-password.txt")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转换证书得到pem证书，执行该命令时需要输入pfx-password.tx中的密码")]),s._v("\nopenssl pkcs12 -in xxx_domain.pfx -nodes -out cacerts.pem\n\nopenssl rsa -in cacerts.pem -out tls.key\nopenssl x509 -in cacerts.pem -out tls.crt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("使用 "),t("code",[s._v("kubectl")]),s._v(" 来创建 "),t("code",[s._v("tls")]),s._v(" 类型的密文。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("kubectl -n cattle-system create secret tls tls-rancher-ingress \\\n  --cert=tls.crt \\\n  --key=tls.key\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("blockquote",[t("p",[t("strong",[s._v("提示：")]),s._v(" 如果您想要更换证书，您可以使用 "),t("code",[s._v("kubectl -n cattle-system delete secret tls-rancher-ingress")]),s._v(" 来删除 "),t("code",[s._v("tls-rancher-ingress")]),s._v(" 密文，之后使用上面的命令创建一个新的密文。如果您使用的是私有 CA 签发的证书，仅当新证书与当前证书是由同一个 CA 签发的，才可以替换。")])]),s._v(" "),t("p",[t("strong",[s._v("提供 CA 证书的副本")])]),s._v(" "),t("p",[s._v("如果您使用的是私有 CA，Rancher 需要您提供 CA 证书的副本，用来校验 Rancher Agent 与 Server 的连接。")]),s._v(" "),t("p",[s._v("拷贝 CA 证书到名为 cacerts.pem 的文件，使用 kubectl 命令在 cattle-system 命名空间中创建名为 tls-ca 的密文。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl -n cattle-system create secret generic tls-ca "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --from-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cacerts.pem"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./cacerts.pem\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"rancher安装-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rancher安装-2"}},[s._v("#")]),s._v(" rancher安装")]),s._v(" "),t("p",[s._v("如果您使用的是私有CA证书，请在命令中增加 "),t("code",[s._v("--set privateCA=true")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  rancher "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  rancher-stable/rancher "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --namespace cattle-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("k8s.ecolovo.icu "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --set ingress.tls.source"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("secret "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("privateCA")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[s._v("#")]),s._v(" 运行")]),s._v(" "),t("p",[s._v("输入地址：https://rancher.my.org")]),s._v(" "),t("p",[s._v("修改密码：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl -n cattle-system "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n cattle-system get pods -l "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rancher "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1/1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{ print $1 }'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" -- reset-password\nNew password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" default administrator "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user-xxxxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("new_password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"遇到的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[s._v("#")]),s._v(" 遇到的问题")]),s._v(" "),t("p",[s._v("问题一：")]),s._v(" "),t("p",[s._v("安装时报错：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("FATA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0215"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Failed to get job complete status "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" job rke-network-plugin-deploy-job "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" namespace kube-system\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("遇到这个问题，重新执行"),t("code",[s._v("./rke up --config ./rancher-cluster.yml")]),s._v("即可")]),s._v(" "),t("h2",{attrs:{id:"运维"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运维"}},[s._v("#")]),s._v(" 运维")]),s._v(" "),t("h3",{attrs:{id:"更新证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新证书"}},[s._v("#")]),s._v(" 更新证书")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./rke cert rotate --config ./rancher-cluster.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);