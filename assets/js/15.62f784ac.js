(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{404:function(t,s,a){"use strict";a.r(s);var n=a(29),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"rancher中nginx-ingress的配置获取真实ip地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rancher中nginx-ingress的配置获取真实ip地址"}},[t._v("#")]),t._v(" rancher中nginx-ingress的配置获取真实IP地址")]),t._v(" "),a("p",[t._v("解决nginx-ingress无法从4层负载均衡器通过"),a("code",[t._v("protocol")]),t._v("协议转发的请求中获取客户端的真实IP地址问题")]),t._v(" "),a("h2",{attrs:{id:"配置rancher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置rancher"}},[t._v("#")]),t._v(" 配置rancher")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("切换到【System】项目中")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqxz0r34fwj31xy0hqdji.jpg",alt:"image-20210528111636735"}})])]),t._v(" "),a("li",[a("p",[t._v("进入【配置映射】中")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqxz1ey0a7j31x80dg778.jpg",alt:"image-20210528111714893"}})])]),t._v(" "),a("li",[a("p",[t._v("找到命名空间"),a("strong",[t._v("ingress-nginx")]),t._v("中的"),a("strong",[t._v("nginx-configuration")]),t._v("配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqxz2q80l4j31zy0ig41h.jpg",alt:"image-20210528111830698"}})])]),t._v(" "),a("li",[a("p",[t._v("打开配置编辑")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqxz4kzryaj31z00ii41u.jpg",alt:"image-20210528112017153"}})])]),t._v(" "),a("li",[a("p",[t._v("添加")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("键")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("compute-full-forwarded-for")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("true")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("use-forwarded-headers")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("true")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("use-proxy-protocol")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("true")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqy0u1k9pij31uj0u0dkh.jpg",alt:"image-20210528121918990"}})])])]),t._v(" "),a("h2",{attrs:{id:"配置负载均衡服务器nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置负载均衡服务器nginx"}},[t._v("#")]),t._v(" 配置负载均衡服务器nginx")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("登陆服务器")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" root@192.168.1.71\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("修改nginx配置文件")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@rancher-lb ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /etc/nginx/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@rancher-lb nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\ncert    data            mime.types  nginx.conf   uwsgi_params\nconf.d  fastcgi_params  modules     scgi_params\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@rancher-lb nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi nginx.conf")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("增加")]),t._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_protocol")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" rancher_servers_https")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gxgsb5jazaj30u0113n0f.jpg",alt:"image-20211217135208601"}})])]),t._v(" "),a("li",[a("p",[t._v("重启nginx")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("nginx -s reload\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);